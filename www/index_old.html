<!DOCTYPE html>
<html lang="pt-br" xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="utf-8" />
  <meta http-equiv="Content-Language" content="pt-br">

  <title>CALCULADORA FINACEIRA</title>
  <link rel="shortcut icon" href="favicon.ico" />

  <link type="text/css" rel="stylesheet" href="styles/kendo.common.min.css" />
  <link type="text/css" rel="stylesheet" href="styles/kendo.rtl.min.css" />
  <link type="text/css" rel="stylesheet" href="styles/custom/custom.css" />
  <link type="text/css" rel="stylesheet" href="styles/kendo.mobile.all.min.css" />
  <link type="text/css" rel="stylesheet" href="styles/kendo.mobile.fiori.min.css" />
  <link type="text/css" rel="stylesheet" href="styles/kendo.default.min.css" />
 
  <script src="js/jquery-1.12.4.min.js"></script>
  <script src="js/kendo.all.min.js"></script>
  <script src="js/cultures/kendo.culture.pt-BR.min.js"></script>
  <style>
 .k-menu .k-state-selected > .k-link {
  color: #fff;
  background-color: #1984c8;
  border-color: #1a87cd;
  background-image: url(textures/highlight.png);
  background-image: none,-webkit-gradient(linear,left top,left bottom,from(rgba(255,255,255,0)),to(rgba(255,255,255,.2)));
  background-image: none,-webkit-linear-gradient(top,rgba(255,255,255,0) 0,rgba(255,255,255,.2) 100%);
  background-image: none,linear-gradient(to bottom,rgba(255,255,255,0) 0,rgba(255,255,255,.2) 100%);
}
    </style>
</head>
<body>

  <div data-role="view" data-title="Calculadora" data-id="main">

    <div data-role="header" style="display:block">
      <div data-role="navbar" class="km-navbar-buttongroup" style="line-height: 1;height:50px">
        <a id="btn_home" class="nav-button" data-align="left" data-icon="home" data-role="button" style="border:none; background-color:transparent;padding:0;padding-right:10px" data-click="exibirHome"></a>
        <a data-role="view-title" data-align="left" style="font-size:small"></a>
        <div data-align="right">
          <ul id="menu_btn" data-role="buttongroup" data-index="0" data-select="onSelect">
            <li>Price</li>
            <li>Sac</li>
          </ul>
        </div>
        <a id="btn_calc" class="nav-button" data-align="right" data-icon="" data-role="button" style="margin-right:2px;" data-click="exibirOpcoes">Calcular</a>
      </div>
    </div>

    <div id="form_home" style="display:block">
      <div class="table">
        <div class="row">
          <div class="cell">Valor Financiado:</div>
          <div class="cell2"><input id="f_valor" style="width:100%" /></div>
        </div>
        <div class="row">
          <div class="cell">Valor de Entrada:</div>
          <div class="cell2"><input id="f_entrada" style="width:100%" /></div>
        </div>
        <div class="row">
          <div class="cell">Nº de Prestações:</div>
          <div class="cell2"><input id="f_parcelas" style="width:100%" /></div>
        </div>
        <div class="row">
          <div class="cell">Data de Vencimento:</div>
          <div class="cell2"><input id="f_data" style="width:100%" /></div>
        </div>
        <div class="row">
          <div class="cell" style="width:30%">Taxa de Juros (%)</div>
          <div class="cell2">
            <div class="row" style="width:100%!important">
              <div class="cellNoBorder" style=""><input id="f_juros" style="float:right;width:100%;" /></div>
              <div class="cellNoBorder" style="">&nbsp;&nbsp;<a id="lbl_taxa" style="font-size:9px;width:100%">10% a.m</a></div>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="cell">Período do Juros:</div>
          <div class="cell2" style="width:150px!important"><ul id="f_pertaxa" style="float:left;margin-right:5px; height:10px!important"><li style="width:80px">MENSAL</li><li style="width:80px">ANUAL</li></ul></div>
        </div>
        <div class="row">
          <div class="cell">Sistema:</div>
          <div class="cell2" style="width:150px!important"><ul id="f_sistema" style="float:left;margin-right:5px; height:10px!important"><li style="width:80px">PRICE</li><li style="width:80px">SAC</li></ul></div>
        </div>
        <div class="row" style="display:none">
          <div class="cell">Tema:</div>
          <div class="cell2">
            <input id="ddlTema" style="width: 100%;"/>
          </div>
        </div>
        <div class="row">
          <div class="cell"></div>
          <div class="cell2"></div>
        </div>
      </div>
    </div>

    <div id="form_price" style="display:none">
      <ul id="panel_price" style="font-size: 3.5vw;">
        <li id="">
          <label>Valor das Prestações (R)</label>
          <div class="">
            <ul class="fieldlist2">
              <li><span id="fp_valor_prestacao" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Saldo Devedor de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fp_ordem_t" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_saldo_devedor_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Saldo Devedor de ordem (t - 1)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fp_ordem_t1" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_saldo_devedor_t1" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Primeira Amortização</label>
          <div>
            <ul class="fieldlist2">
              <li><span id="fp_valor_amortizacao_1" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Parcela de Amortização de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fp_ordem_t3" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_amortizacao_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Amortizações acumuladas até o período (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fp_ordem_t4" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_amortizacao_ta" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Amortizações acumuladas entre os períodos (t) e (t + k)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fp_ordem_t5" style="padding-left:2px;width:80px;" />+<input id="fp_ordem_t5k" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_amortizacao_tk" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Parcela de Juros de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fp_ordem_t2" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_juros_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Juros acumulados até um tempo (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fp_ordem_t6" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_juros_ta" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Juros acumulados entre os período (t) e (t + k)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fp_ordem_t7" style="padding-left:2px;width:80px;" />+<input id="fp_ordem_t7k" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fp_valor_juros_tk" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="grid">
          <label>Tabela</label>
          <div id="container">
            <div id="gridprice" class="prop-text"></div>
            <p />
          </div>
        </li>
      </ul>
    </div>

    <div id="form_sac" style="display:none">
      <ul id="panel_sac" style="font-size: 3.5vw;">
        <li id="">
          <label>Valor da Amortização (A)</label>
          <div class="">
            <ul class="fieldlist2">
              <li><span id="fs_valor_amortizacao" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Saldo Devedor de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fs_ordem_t" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_saldo_devedor_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Saldo Devedor de ordem (t - 1)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fs_ordem_t1" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_saldo_devedor_t1" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Parcela de Juros de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Ordem:<input id="fs_ordem_t2" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_juros_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Prestação de ordem (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fs_ordem_t4" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_prestacao_t" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Soma Amortizações nos períodos (t) á (t + k)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fs_ordem_t3" style="padding-left:2px;width:80px;" />+<input id="fs_ordem_t3k" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_amortizacao_tk" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Juros acumulados até um tempo (t)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fs_ordem_t5" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_juros_ta" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Soma dos Juros entre os períodos (t) e (t + k)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fs_ordem_t6" style="padding-left:2px;width:80px;" />+<input id="fs_ordem_t6k" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_juros_tk" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Soma das Prestações acumuladas</label>
          <div>
            <ul class="fieldlist2">
              <li><span id="fs_valor_prestacao_ta" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Soma das Prestações entre os períodos (t) e (t + k)</label>
          <div>
            <ul class="fieldlist2">
              <li>Período:<input id="fs_ordem_t7" style="padding-left:2px;width:80px;" />+<input id="fs_ordem_t7k" style="padding-left:2px;width:80px;" /></li>
              <li><span id="fs_valor_prestacao_tk" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="">
          <label>Descréscimo nas Prestações</label>
          <div>
            <ul class="fieldlist2">
              <li><span id="fs_valor_decrescimo" class="valuefield" /></li>
            </ul>
            <p />
          </div>
        </li>
        <li id="grid">
          <label>Tabela</label>
          <div id="container">
            <div id="gridsac" class="prop-text"></div>
          </div>
        </li>
      </ul>
    </div>

    <!--<footer data-role="footer">
      <h2>Footer</h2>
    </footer>-->


  </div>

  <script>

    kendo.culture("pt-BR");

    var tabelaPrice;
    var tabelaSAC;
    var controlId;
    var app;

    //var app = new kendo.mobile.Application(document.body);

    var app = new kendo.mobile.Application(document.body, {
      skin: "fiori",
      transition: "slide",
      useNativeScrolling: false
    });

    var theme = {
      changeTheme: function () {
        var selected = this.value;
        localStorage.setItem("theme-kendo", selected);
        window.location.reload();
      },

      loadTheme: function () {
        //var thm1 = localStorage.getItem("theme-kendo"); // kendo.bootstrap.min.css
        //var css1 = $('link[href^="styles/"]')[3];  // retorna o CSS ancora estilo
        //css1.href = 'styles/' + thm1 + '.min.css';

        // <link id="4" type="text/css" rel="stylesheet" href="styles/kendo.bootstrap.min.css" />
        // <link id="5" type="text/css" rel="stylesheet" href="styles/kendo.bootstrap.mobile.min.css" />
        var thm1 = localStorage.getItem("theme-kendo"); // kendo.bootstrap.min.css
        var thm2 = thm1 + ".mobile";
        var lnks = $('link[href^="styles/"]');  // retorna o array de styles
        var css1 = lnks[3];  // styles/kendo.bootstrap.min.css
        var css2 = lnks[4];  // styles/kendo.bootstrap.mobile.min.css
        css1.href = 'styles/' + thm1 + '.min.css';
        css2.href = 'styles/' + thm2 + '.min.css';
      }
    };

    //var app = new kendo.mobile.Application(document.body);
    $(function () {

      //app.showLoading();
      //setTimeout(function () { app.hideLoading(); }, 2000);

      kendo.init($(document.body));

      $(document.body).addClass("k-content");

      // !!! DESATIVADO TEMPORIAMENTE A OPÇÃO DE SELECIONAR "TEMAS"
      //theme.loadTheme();

      $('#ddlTema').kendoComboBox({
        dataSource: [
          {value: "kendo.bootstrap", name: "Bootstrap"},
          {value: "kendo.default", name: "Default"},
          {value: "kendo.black", name: "Black"},
          {value: "kendo.blueopal", name: "BlackOpal"},
          {value: "kendo.fiori", name: "Fiori"},
          {value: "kendo.flat", name: "Flat"},
          {value: "kendo.highcontrast", name: "High Constrast"},
          {value: "kendo.material", name: "Material Light"},
          {value: "kendo.materialblack", name: "Material Black"},
          {value: "kendo.metro", name: "Metro Light"},
          {value: "kendo.metroblack", name: "Metro Black"},
          {value: "kendo.moonlight", name: "Moonlight"},
          {value: "kendo.nova", name: "Nova"},
          {value: "kendo.office365", name: "Office"},
          {value: "kendo.silver", name: "Silver"},
        ],
        dataTextField: "name",
        dataValueField: "value",
        clearButton: false,
        suggest: false,
        index: 0,
        minLength: 3,
        enforceMinLength: true
      }).on('change', theme.changeTheme);

      var combobox = $("#ddlTema").data("kendoComboBox");
      var curtheme = getCurrentTheme();
      combobox.select(function (dataItem) { return dataItem.value === curtheme });

      $(form_home).ready(function () {
        $("#f_valor").kendoNumericTextBox({ format: "c", value: 10000, decimals: 2, placeholder: "Digite o valor da dívida" });
        $("#f_entrada").kendoNumericTextBox({ format: "c", decimals: 2, value: 0, placeholder: "Digite o valor de entrada" });
        $("#f_parcelas").kendoNumericTextBox({ format: "0", value: 5, min: 0, max: 600, step: 1, placeholder: "Digite o número de parcelas" });
        $("#f_juros").kendoNumericTextBox({ format: "0.00", value: 10, decimals: 2, min: 0, max: 100, step: 0.1, placeholder: "Digite a taxa de juros", spin: atualizarPercentual, change: atualizarPercentual });
        $("#f_data").kendoDatePicker({ value: new Date(), placeholder: "Digite a data da primeira parcela" });
        $("#f_tipo").kendoDropDownList({ index: 0, placeholder: "Selecione o método de amortização" });

      });

      $("#panel_price").kendoPanelBar();
      $("#panel_sac").kendoPanelBar();

      $("#gridprice").kendoGrid();
      $("#gridsac").kendoGrid();

      // seleciona o periodo Mensal
      $("#f_pertaxa").kendoMobileButtonGroup({
        select: function (e) { atualizarPercentual(); },
        index: 0
      });

      // seleciona o periodo Mensal
      $("#f_sistema").kendoMobileButtonGroup({ index: 0 });

      controlId = 0;
      showButtons(0);
      hideButtons(1);
      exibirHome();

    });

    function showForm(f) {

      if (f == -1) {
        if (controlId > 1) {
          if (controlId > 1 && controlId < 2) { showForm(1); return; };
          if (controlId > 2 && controlId < 3) { showForm(2); return; };
        };
        showForm(0);
        return;
      };

      hideWindows(); // oculta todas as janelas e botões da barra de navegação

      // exibir Home
      if (f == 0) {
        showButtons(0); // exibe o botão calcular
        form_home.style.display = "block";
        form_home.scrollTop = 0;
        controlId = 0;
        return;
      };

      // exibe as opções do Sistema PRICE
      if (f == 1) {
        $("#menu_btn").data("kendoMobileButtonGroup").select(0); // PRICE
        showButtons(1); // exibe os botões PRICE e SAC
        form_price.style.display = "block";
        form_price.scrollTop = 0;
        //$("#panel_price").kendoPanelBar().focus();
        controlId = 1;
        return;
      };

      // exibe as opções do Sistema SAC
      if (f == 2) {
        $("#menu_btn").data("kendoMobileButtonGroup").select(1); // SAC
        showButtons(1); // exibe os botões PRICE e SAC
        form_sac.style.display = "block";
        form_sac.scrollTop = 0;
        //$("#panel_sac").kendoPanelBar().focus();
        controlId = 2;
        return;
      };

    };

    function showButtons(option) {
      hideButtons(option, false);
    };

    function hideButtons(option, value) {
      var filter;
      if (option == 0) {
        filter = "#btn_calc";
      } else if (option == 1) {
        filter = "#menu_btn";
        //filter = ".menu-option-button";
      } else {
        return;
      }
      if (value == null || value == true) {
        app.view().header.find(filter).hide();
      } else {
        app.view().header.find(filter).show();
      }
    };

    function hideWindows() {
      hideButtons(0);
      hideButtons(1);
      form_home.style.display = "none";
      form_price.style.display = "none";
      form_sac.style.display = "none";
    };

  </script>

  <script>

    function onSelect(e) {
      var index = this.current().index();
      if (index == 0) { exibirOpcoesPrice(); }
      if (index == 1) { exibirOpcoesSAC(); }
    }

    function atualizarPercentual() {
      var j = retornaPercentualJuros(true);
      var s = kendo.toString(j) + "% a.m.";
      setValue("lbl_taxa", s);
    };

    function exibirOpcoes() {
      calcularDados();
      atualizarTabelaPrice();
      atualizarTabelaSAC();

      var t = tabelaPrice.length - 1;

      // inicializa os controles para Price
      $("#fp_ordem_t").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t1").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t2").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t3").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t4").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t5").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t5k").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t6").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t7").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });
      $("#fp_ordem_t7k").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosPrice, change: exibirDadosPrice });

      // inicializa os controles para Price
      $("#fs_ordem_t").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t1").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t2").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t3").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t3k").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t4").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t5").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t6").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t6k").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t7").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });
      $("#fs_ordem_t7k").kendoNumericTextBox({ format: "0", value: 0, width: 20, min: 0, max: t, step: 1, spin: exibirDadosSAC, change: exibirDadosSAC });

      // 0:PRICE, 1:SAC
      var sistema = kendo.parseInt($("#f_sistema").data("kendoMobileButtonGroup").current().index());
      if (sistema == 0) { exibirOpcoesPrice(); }
      if (sistema == 1) { exibirOpcoesSAC(); }

    };

    function exibirHome() {
      showForm(0);
    };

    function exibirOpcoesPrice() {

      app.skin = "nova";

      exibirDadosPrice();
      showForm(1);
    };

    function exibirOpcoesSAC() {
      app.skin = "material";
      exibirDadosSAC();
      showForm(2);
    };

    function exibirDadosPrice() {
      var dataSource = tabelaPrice;
      var t = dataSource.length;
      var i, v, a, k;

      // valor das prestações
      i = 1;
      v = ((i >= 0 && i < t) ? dataSource[i].Prestacao : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_valor_prestacao", v, "c2");

      // valor saldo devedor de orrdem (t)
      i = kendo.parseInt($("#fp_ordem_t").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Saldo : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_saldo_devedor_t", v, "c2");

      // valor saldo devedor de orrdem (t-1)
      i = kendo.parseInt($("#fp_ordem_t1").val()) - 1;
      v = ((i >= 0 && i < t) ? dataSource[i].Saldo : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_saldo_devedor_t1", v, "c2");

      // valor parcela juros de orrdem (t)
      i = kendo.parseInt($("#fp_ordem_t2").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Juros : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_valor_juros_t", v, "c2");

      // valor parcela juros de orrdem (t)
      i = 1;
      v = ((i >= 0 && i < t) ? dataSource[i].Amortizacao : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_valor_amortizacao_1", v, "c2");

      // valor parcela de amortização de ordem (t)
      i = kendo.parseInt($("#fp_ordem_t3").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Amortizacao : null);
      v = ((v == null) ? 0 : v);
      setValue("fp_valor_amortizacao_t", v, "c2");

      // valor das amortizações acumuladas até o período (t)
      i = kendo.parseInt($("#fp_ordem_t4").val());
      a = 0;
      for (j = 0; j <= i; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Amortizacao : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fp_valor_amortizacao_ta", a, "c2");

      // valor das amortizações acumuladas entre os período (t) e (t + k)
      i = kendo.parseInt($("#fp_ordem_t5").val());
      k = kendo.parseInt($("#fp_ordem_t5k").val());
      a = 0;
      for (j = i; j <= i + k; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Amortizacao : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fp_valor_amortizacao_tk", a, "c2");

      // juros acumuladas até um tempo (t)
      i = kendo.parseInt($("#fp_ordem_t6").val());
      a = 0;
      for (j = 0; j <= i; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Juros : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fp_valor_juros_ta", a, "c2");

      // Juros acumuladas entre os período (t) e (t + k)
      i = kendo.parseInt($("#fp_ordem_t7").val());
      k = kendo.parseInt($("#fp_ordem_t7k").val());
      a = 0;
      for (j = i; j <= i + k; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Juros : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fp_valor_juros_tk", a, "c2");

    };

    function exibirDadosSAC() {
      var dataSource = tabelaSAC;
      var t = dataSource.length;
      var i, v, a, k;

      // valor da amortização (a)
      i = 1;
      v = ((i >= 0 && i < t) ? dataSource[i].Amortizacao : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_valor_amortizacao", v, "c2");

      // valor saldo devedor de ordem (t)
      i = kendo.parseInt($("#fs_ordem_t").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Saldo : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_saldo_devedor_t", v, "c2");

      // saldo devedor de ordem (t - 1)
      i = kendo.parseInt($("#fs_ordem_t1").val()) - 1;
      v = ((i >= 0 && i < t) ? dataSource[i].Saldo : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_saldo_devedor_t1", v, "c2");

      // parcela de juros de ordem (t)
      i = kendo.parseInt($("#fs_ordem_t2").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Juros : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_valor_juros_t", v, "c2");

      // prestação de ordem (t)
      i = kendo.parseInt($("#fs_ordem_t4").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Prestacao : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_valor_prestacao_t", v, "c2");

      // soma amortizações nos período (t) á (t + k)
      i = kendo.parseInt($("#fs_ordem_t3").val());
      k = kendo.parseInt($("#fs_ordem_t3k").val());
      a = 0;
      for (j = i; j <= i + k; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Amortizacao : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fs_valor_amortizacao_tk", a, "c2");

      // juros acumulados até um tempo (t)
      i = kendo.parseInt($("#fs_ordem_t5").val());
      v = ((i >= 0 && i < t) ? dataSource[i].Juros : null);
      v = ((v == null) ? 0 : v);
      setValue("fs_valor_juros_ta", v, "c2");

      // soma dos juros entre os período (t) e (t + k)
      i = kendo.parseInt($("#fs_ordem_t6").val());
      k = kendo.parseInt($("#fs_ordem_t6k").val());
      a = 0;
      for (j = i; j <= i + k; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Juros : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fs_valor_juros_tk", a, "c2");

      // soma das prestações acumuladas
      i = t;
      a = 0;
      for (j = 0; j <= i; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Prestacao : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fs_valor_prestacao_ta", a, "c2");

      // soma das prestações entre os período (t) e (t + k)
      i = kendo.parseInt($("#fs_ordem_t7").val());
      k = kendo.parseInt($("#fs_ordem_t7k").val());
      a = 0;
      for (j = i; j <= i + k; j++) {
        v = ((j >= 0 && j < t) ? dataSource[j].Prestacao : null);
        v = ((v == null) ? 0 : v);
        a += v;
      };
      setValue("fs_valor_prestacao_tk", a, "c2");

      // descréscimo nas prestações
      i = t - 1; // a última linha da colunas de juros contém o valor do decréscimo das parcelas, é um valor constante entre uma parcela e outra
      a = dataSource[i].Juros;
      setValue("fs_valor_decrescimo", a, "c2"); // NÃO IMPLEMENTADO

    };

    function atualizarTabelaPrice() {
      atualizarGrid($("#gridprice"), tabelaPrice);
    };

    function atualizarTabelaSAC() {
      atualizarGrid($("#gridsac"), tabelaSAC);
    };

    function atualizarGrid(grid, matriz) {

      var gtab = grid.kendoGrid({
        dataSource: {
          data: matriz,
          serverSorting: "true",
          serverPaging: "true",
          aggregate:
            [
              { field: "Juros", aggregate: "sum" },
              { field: "Prestacao", aggregate: "sum" },
              { field: "Prestacao", aggregate: "min" },
              { field: "Prestacao", aggregate: "max" }
            ],
          schema: {
            culture: "en-GB",
            model: {
              fields: {
                Parcela: { type: "number" },
                Data: { type: "date" },
                Prestacao: { type: "number" },
                Juros: { type: "number" },
                Amortizacao: { type: "number" },
                Saldo: { type: "number" }
              }
            }
          },
        },
        //toolbar: ["pdf"],
        scrollable: false,
        resizable: true,
        columns: [
            { field: "Parcela", title: "Nº", format: "{0}", attributes: { style: "text-align:center;" } },
            { field: "Data", title: "Data", format: "{0:d}", attributes: { style: "text-align:center;" } },
            {
              field: "Prestacao", title: "Prestação", format: "{0:c2}", attributes: { style: "text-align:right;" },
              footerTemplate: "<div>#= kendo.toString(sum, 'c2') #</div>"
            },
            {
              field: "Juros", title: "Juros", format: "{0:c2}", attributes: { style: "text-align:right;" },
              footerTemplate: "<div>#= kendo.toString(sum, 'c2') #</div>"
            },
            { field: "Amortizacao", title: "Amortização", format: "{0:c2}", attributes: { style: "text-align:right;" } },
            { field: "Saldo", title: "Saldo Devedor", format: "{0:c2}", attributes: { style: "text-align:right;" } }
        ]
      }).data("kendoGrid");

      //for (var i = 0; i < gtab.columns.length; i++) {
      //  gtab.autoFitColumn(i);
      //};

      gtab.dataSource.read();
      gtab.refresh();

      //gtab.autoFitColumn(0);
      //gtab.autoFitColumn(1);

    };

    function retornaPercentualJuros(round) {
      var t = kendo.parseInt($("#f_pertaxa").data("kendoMobileButtonGroup").current().index()); //0: MENSAL 1:ANUAL
      var j = kendo.parseFloat($("#f_juros").val()); // campo juros
      if (j > 0) {
        // se estiver selecionado ANUAL (1), então deve devidir por 12
        if (t == 1) { j = (j / 12); };
      } else {
        j = 0;
      };
      // divide por 100
      j = (j / 100);
      if (round == true) {
        j = Math.round10(j, -5); // arredonda 5 casas decimais
      };
      return j;
    };

    function calcularDados() {
      var valor = $("#f_valor").val();
      var entrada = $("#f_entrada").val();
      var juros = retornaPercentualJuros(false); // esta função já retorna o juros dividido por 100 e por 12 se for ANUAL
      var parcelas = $("#f_parcelas").val();
      var data = $("#f_data").val();
      var sistema = $('#f_tipo').prop('selectedIndex');
      var carencia = null;
      var valfuturo = null;
      // criar o objeto principal para montagem da tabela
      tabelaPrice = calcularMatriz(valor, entrada, juros, parcelas, data, carencia, 0, valfuturo);
      tabelaSAC = calcularMatriz(valor, entrada, juros, parcelas, data, carencia, 1, valfuturo);
    };

    function calcularMatriz(valor, entrada, juros, parcelas, data, carencia, sistema, valfuturo) {
      // ajusta os valores de entrada
      valor = kendo.parseFloat(valor);
      valor = ((valor == null || valor < 0) ? 0 : valor);
      entrada = kendo.parseFloat(entrada);
      entrada = ((entrada == null || entrada < 0) ? 0 : entrada);
      carencia = kendo.parseFloat(carencia);
      carencia = ((carencia == null || carencia < 0) ? 0 : carencia);
      juros = ((juros == null || juros < 0) ? 0 : juros);
      parcelas = ((juros == parcelas || parcelas < 0) ? 0 : parcelas);

      // determinar a data presente
      if ((data == null) || (!data) ? true : false) {
        data = new Date;
        data.setMonth(data.getMonth() + 1 + carencia);
      } else {
        data = new Date(kendo.parseDate(data));
      }

      var tab_price = ((sistema == null || sistema == 0) ? true : false); //0: SISTEMA PRICE, 1:SISTEMA SAC

      //var tax_anual = ((pertaxa == null || pertaxa == 0) ? true : false); //0: MENSAL, 1: ANUAL

      var tax_juros = kendo.parseFloat(juros); // a taxa de juros já deve estar em divida 100 e se for ANUAL já deve estar dividida por 12
      var num_parcelas = kendo.parseInt(parcelas);
      var val_presente = ((valor < 0 || valor < entrada) ? 0 : valor - entrada);
      var dat_presente = data;
      var tip_calculo = null;
      var val_futuro = valfuturo;  // não implementado
      var val_amortizado;
      var val_prestacao;
      var val_juros;

      var items = [];

      for (i = 0; i <= parcelas; i++) {
        var obj = {};
        obj['Parcela'] = i;
        if (i == 0) {
          obj['Data'] = null;
          obj['Prestacao'] = null;
          obj['Juros'] = null;
          obj['Amortizacao'] = null;
          obj['Saldo'] = val_presente;
          // na tabela PRICE o valor da prestação é constante, então deve calcular uma única vez
          if (tab_price) {
            val_prestacao = calcularValorPrestacaoPRICE(val_presente, tax_juros, num_parcelas, val_futuro, tip_calculo);
          } else {
            val_amortizado = calcularValorAmortizadoSAC(val_presente, num_parcelas);
          };
        } else {
          if (tab_price) {
            val_juros = calcularValorJuros(val_presente, tax_juros);
            val_amortizado = calcularValorAmortizadoPRICE(val_prestacao, val_juros);
          } else {
            val_juros = calcularValorJuros(val_presente, tax_juros);
            val_prestacao = calcularValorPrestacaoSAC(val_amortizado, val_juros);
          };
          val_presente = (val_presente - val_amortizado);
          val_presente = ((val_presente < 0) ? 0 : val_presente);
          // atribui os dados no objeto em memória
          obj['Data'] = new Date(dat_presente);
          obj['Prestacao'] = val_prestacao;
          obj['Juros'] = val_juros;
          obj['Amortizacao'] = val_amortizado;
          obj['Saldo'] = val_presente;
          // posiciona a data no mês seguinte
          dat_presente.setMonth(dat_presente.getMonth() + 1);
        };
        items.push(obj);
        if (valor <= 0) {
          break;
        }
      };
      return items;
    };

    function calcularValorJuros(val_presente, taxa_juros) {
      var J = (taxa_juros * val_presente);
      return J;
    };

    function calcularValorPrestacaoPRICE(val_presente, taxa_juros, num_parcela, val_futuro, tipo) {
      var a = Math.pow((1 + taxa_juros), num_parcela) * taxa_juros;
      var b = Math.pow((1 + taxa_juros), num_parcela) - 1;
      //a = Math.round10(a, -5);
      //b = Math.round10(b, -5);
      var P = (val_presente * (a / b));
      return P;
    };

    function calcularValorPrestacaoSAC(val_amortizado, val_juros) {
      var P = (val_amortizado + val_juros);
      return P;
    };

    function calcularValorAmortizadoPRICE(val_prestacao, val_juros) {
      var A = (val_prestacao - val_juros);
      return A;
    };

    function calcularValorAmortizadoSAC(val_prestacao, num_parcela) {
      var A = (val_prestacao / num_parcela);
      return A;
    };

  </script>

  <script>

    function setValue(id, value, format) {
      document.getElementById(id).innerHTML = kendo.toString(value, format);
    }

    function getCurrentTheme() {
      var lnks = $('link[href^="styles/"]');  // retorna o array de styles
      var css1 = lnks[3];  // styles/kendo.bootstrap.min.css
      var value = css1.href
      var posb = value.lastIndexOf("/");
      value = value.substring(value.lastIndexOf("/") + 1);
      value = value.replace(".min.css", "");
      return value;
    };


  </script>

  <script>


    (function () {

      /**
       * Decimal adjustment of a number.
       *
       * @param	{String}	type	The type of adjustment.
       * @param	{Number}	value	The number.
       * @param	{Integer}	exp		The exponent (the 10 logarithm of the adjustment base).
       * @returns	{Number}			The adjusted value.
       */
      function decimalAdjust(type, value, exp) {
        // If the exp is undefined or zero...
        if (typeof exp === 'undefined' || +exp === 0) {
          return Math[type](value);
        }
        value = +value;
        exp = +exp;
        // If the value is not a number or the exp is not an integer...
        if (isNaN(value) || !(typeof exp === 'number' && exp % 1 === 0)) {
          return NaN;
        }
        // Shift
        value = value.toString().split('e');
        value = Math[type](+(value[0] + 'e' + (value[1] ? (+value[1] - exp) : -exp)));
        // Shift back
        value = value.toString().split('e');
        return +(value[0] + 'e' + (value[1] ? (+value[1] + exp) : exp));
      }

      // Decimal round
      if (!Math.round10) {
        Math.round10 = function (value, exp) {
          return decimalAdjust('round', value, exp);
        };
      }
      // Decimal floor
      if (!Math.floor10) {
        Math.floor10 = function (value, exp) {
          return decimalAdjust('floor', value, exp);
        };
      }
      // Decimal ceil
      if (!Math.ceil10) {
        Math.ceil10 = function (value, exp) {
          return decimalAdjust('ceil', value, exp);
        };
      }

    })();

  </script>


</body>
</html>